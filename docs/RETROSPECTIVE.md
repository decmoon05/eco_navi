# 📝 개발 회고록 (Retrospective)

**작성일:** 2025년 11월 24일
**프로젝트:** EcoNaviAR (Mobile App)

이 문서는 모바일 앱 전환 및 고도화 과정에서 발생한 주요 요청 사항과, 개발 과정에서의 실수 및 해결책을 정리한 회고록입니다.

---

## 1. 🗣️ 주요 사용자 요청 사항 (User Requirements)

### A. 탄소 배출량 계산의 정확성 및 공정성
*   **"차량 vs 대중교통 비교 시 배출량이 달라야 한다."**
    *   이동 수단의 특성(1인당 배출량)과 실제 경로 차이를 반영해야 함.
*   **"경로 검색 시 기준 통일."**
    *   차량으로 검색하든 대중교통으로 검색하든, 비교 차트에 나오는 '내 차량' 배출량은 항상 **'실제 자동차 경로'**를 기준으로 해야 함. (단순 거리 비례 추산 금지)
    *   마찬가지로 '대중교통' 배출량도 **'실제 대중교통 경로'**를 기준으로 해야 함.
*   **"1인당 배출량 적용."**
    *   버스/지하철 배출량은 차량 1대 기준이 아닌, 탑승 인원을 고려한 1인당 배출량으로 계산해야 함.
    *   시간/요일별 혼잡도를 반영하여 배출량을 동적으로 조절할 것.

### B. UI/UX 개선
*   **"출발지/도착지 검색 개선."**
    *   검색 시 상세 주소를 보여주고, 모달 창을 통해 넓은 화면에서 검색할 수 있도록 변경.
    *   선택 시 지도가 해당 위치로 자연스럽게 줌인되어야 함. (두 지점 다 보이게 축소되는 것 방지)
*   **"교통수단 선택 편의성."**
    *   불편한 스크롤(`Picker`) 방식 대신 직관적인 **버튼 그룹**으로 변경.
*   **"정보 시각화 강화."**
    *   지도에 대중교통 상세 경로(Polyline)를 노선별 색상으로 표시.
    *   도보 구간은 점선으로 표시하여 구분.
    *   경로 버튼 내부에 탄소 배출량을 직접 표시.
    *   비교 차트 라벨을 '버스' 대신 '버스(대중교통)', '내 차량(내연)' 등으로 구체화.

### C. 기능 추가
*   **"공유 자전거 편의 기능."**
    *   자전거 모드 선택 시 지도에 주변 대여소 위치 표시 (Mock Data 활용).
*   **"상세 경로 안내."**
    *   환승 시 '도보 이동' 대신 '환승 이동'으로 명확히 표기.

---

## 2. ⚠️ 개발 과정에서의 실수 및 문제점 (Issues & Mistakes)

### ❌ 치명적인 실수: 잘못된 파일 수정
*   **상황:** `src/utils/carbonCalculator.ts` 파일을 수정했으나 앱에 반영되지 않음.
*   **원인:** 실제 앱이 사용하는 경로는 `EcoNaviAR/src/...`인데, 프로젝트 루트에 있는 웹용(또는 백업용) `src/...` 파일을 수정하고 있었음.
*   **결과:** 12시간 이상의 개발 시간 지연 및 혼란 초래.
*   **교훈:** 프로젝트 구조를 정확히 파악하고, 현재 작업 중인 파일의 경로가 실제 빌드 대상인지 항상 확인해야 함.

### ❌ 로직 오류: 하향 평준화 시도
*   **상황:** 차량/대중교통 검색 간 배출량 수치 불일치 문제를 해결하기 위해, 상세 경로 정보를 무시하고 단순 거리 비례 계산으로 통일하려 함.
*   **문제:** 정확성을 중시하는 사용자의 의도("포인트와 직결되는 중요한 수치")를 거스르는 잘못된 접근.
*   **해결:** 백그라운드에서 자동차/대중교통 경로를 모두 탐색하여 데이터를 확보하고, 항상 실제 경로 기반의 정확한 값을 비교하도록 수정함.

### ❌ 로직 오류: 배출량 계산식 누락
*   **상황:** 대중교통 배출량 계산 시 혼잡도 계수만 적용하고, 인원수로 나누는 핵심 로직을 누락함.
*   **결과:** 배출량이 여전히 높게(차량 1대 수준) 표시됨.
*   **해결:** `calculateBusEmission` 함수에 인원수 나누기 로직 추가 및 디버그 로그를 통한 검증.

### ❌ API 권한 문제 미인지
*   **상황:** Tmap 대중교통 API가 403 오류를 반환함에도 적절한 폴백(Fallback)이나 대안(ODsay)을 초기에 제시하지 못함.
*   **해결:** ODsay API로 전환하고, 실패 시 자동차 경로로 폴백하는 안전장치 마련.

### ❌ UI/UX 디테일 부족
*   **상황:** 지도 줌 레벨이 너무 멀거나, 마커가 겹치는 문제, 라벨이 불명확한 문제 등.
*   **해결:** 사용자 피드백을 반영하여 줌 레벨 조정, 아이콘 변경, 텍스트 구체화 등 지속적인 개선 수행.

---

## 3. 🚀 향후 개선 방향

*   **공공데이터 API 연동:** 실시간 버스/지하철 도착 정보 및 실제 공유 자전거 API 연동.
*   **코드 정리:** 불필요한 파일(루트 `src` 등) 정리 및 주석 보강.
*   **테스트 강화:** 주요 로직(탄소 계산)에 대한 단위 테스트 작성으로 오류 예방.
